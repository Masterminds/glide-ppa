#!/bin/bash
SRC="src"

getGox() {
	GOX=$(which gox)
	if [[ "$?" != 0 ]]; then
		echo "Getting gox..."
		go get -u github.com/mitchellh/gox
	fi
}

getGox
set -e
cd glide/debian
mkdir -p i386
mkdir -p amd64
mkdir -p release
rm -Rf $SRC
git clone git@github.com:franciscocpg/glide.git $SRC
cd $SRC
VERSION=$(git describe --abbrev=0 --tags)
git checkout "${VERSION}"
gox -verbose -ldflags "-X main.version=${VERSION}" -os="linux" -arch="amd64 386" -output="dist/{{.OS}}-{{.Arch}}/glide" .
cp dist/linux-386/glide ../i386
cp dist/linux-amd64/glide ../amd64
cd ../../
debuild -S -sa